<?xml version="1.0" encoding="UTF-8"?>

<odoo>

    <record id="onchange_rule_tree" model="ir.ui.view">
        <field name="model">onchange.rule</field>
        <field name="arch" type="xml">
            <tree>
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="model_id"/>
                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
            </tree>
        </field>
    </record>

    <record id="onchange_rule_form_view" model="ir.ui.view">
        <field name="model">onchange.rule</field>
        <field name="arch" type="xml">
            <form>
                <h2>
                    <field name="name" placeholder="Name"/>
                </h2>
                <group col="4">
                    <field name="model_id"/>
                    <field name="active"/>
                    <field name="sequence"/>
                    <field name="company_id" groups="base.group_multi_company"
                           options="{'no_create': True}"/>
                </group>
                <group col="4">
                    <field name="rule_line_ids" colspan="4" nolabel="1">
                        <form string="Rules lines">
                            <group>
                                <group string="Source">
                                    <field name="onchange_field_id"
                                        domain="[('model_id', '=', parent.model_id),
                                        ('ttype', 'in', ('many2one', 'selection'))]"/>
                                    <field name="implied_model" readonly="1"/>
                                    <label for="implied_record"/>
                                    <div>
                                        <field
                                            context="{'onchange_field_id':
                                             onchange_field_id,}"
                                            name="implied_record" class="oe_inline"/>
                                    </div>
                                </group>
                                <group string="Destination">
                                    <field name="dest_field_id"
                                    domain="[('model_id', '=', parent.model_id),
                                    ('ttype', 'in', ('many2one', 'selection'))]"/>
                                    <field name="dest_val_type" widget="radio"/>
                                    <field name="dest_related_field" string="Related Field"
                                           attrs="{'required': [('dest_val_type', '=', 'related')], 'invisible': [('dest_val_type', '!=', 'related')]}"
                                        placeholer="partner_id.price_list_id"/>
                                    <field name="dest_m2o_value"
                                        context="{'dest_field_id': onchange_field_id}"
                                        attrs="{
                                        'invisible': ['|', ('dest_selection_value', '!=', False), ('dest_val_type', '!=', 'fixed')]}"/>
                                    <field name="dest_selection_value" string="Selection Value"
                                           attrs="{'invisible': [('dest_val_type', '!=', 'fixed')]}"/>
                                    <field name="is_restrictive_rule"/>
                                </group>
                                <group string="Onchange Parameters" colspan="4">
                                    <field name="onchange_domain" placeholder="{'partner_id': [('name', '=', 'Akretion')]}"/>
                                    <field name="onchange_warning" />
                                </group>
                            </group>
                        </form>
                        <tree>
                            <field name="sequence" widget="handle"/>
                            <field name="onchange_field_id"
                                   domain="[('model_id', '=', parent.model_id),
                                            ('ttype', 'in', ('many2one', 'selection'))]"/>
                            <field name="implied_model" readonly="1"/>
                            <field name="implied_record"
                                   context="{'onchange_field_id': onchange_field_id}"/>
                            <field name="dest_field_id" string="Destination Field"
                                   domain="[('model_id', '=', parent.model_id),
                                            ('ttype', 'in', ('many2one', 'selection'))]"/>
                            <field name="dest_related_field" string="Dest. Related Field"/>
                            <field name="dest_m2o_value" string="M2o Value"
                                   context="{'dest_field_id': onchange_field_id}"/>
                            <field name="dest_selection_value" string="Select. Value"/>
                            <field name="onchange_domain"/>
                            <field name="is_restrictive_rule" string="Restrictive"/>
                            <button name="duplicate_record" type="object" icon="fa-copy"/>
                        </tree>
                    </field>
                </group>
            </form>
        </field>
    </record>

    <record id="onchange_rule_action" model="ir.actions.act_window">
        <field name="name">Onchange Rules</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">onchange.rule</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[]</field>
        <field name="context">{}</field>
    </record>

    <menuitem action="onchange_rule_action"
              id="menu_onchange_rule_action"
              parent="base.menu_automation" sequence="10"/>

</odoo>
